<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Make a Wish Appii üéÇ</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

body{
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#ffeaf4;
    overflow:hidden;
    font-family:"Dancing Script", cursive;
}

.cake-container {
    background: white;
    padding: 50px 40px;
    border-radius: 30px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    position: relative;
    z-index: 2;
    text-align: center;
    min-height: 420px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.message{
    background:transparent;
    padding:10px 0;
    border-radius:0;
    font-size:28px;
    font-weight:700;
    color:#c41e3a;
    opacity:0;
    scale:0.5;
    position:relative;
    z-index:3;
    font-family: "Amatic SC", cursive;
    line-height: 1.3;
}

.message.show{
    animation:pop 0.6s forwards;
}

.message.final{
    cursor:pointer;
    font-size:36px;
}

.hearts-wrapper{
    position:fixed;
    inset:0;
    overflow:hidden;
    pointer-events:none;
    z-index:0;
}

.heart{
    position:absolute;
    bottom:-40px;
    width:18px;
    height:18px;
    background:#e91e63;
    transform:rotate(45deg);
    opacity:0.4;
    animation:floatUp linear infinite;
}

.heart::before,
.heart::after{
    content:"";
    position:absolute;
    width:18px;
    height:18px;
    background:#e91e63;
    border-radius:50%;
}

.heart::before{ top:-9px; left:0; }
.heart::after{ left:-9px; top:0; }

@keyframes floatUp{
    0%{ transform:translateY(0) rotate(45deg); opacity:0;}
    10%{ opacity:0.4;}
    100%{ transform:translateY(-100vh) rotate(45deg); opacity:0;}
}

.cake{
    position:relative;
    width:320px;
    height:300px;
    margin:0 auto;
    flex-grow: 1;
    display: flex;
    align-items: flex-end;
}

.layer1{
    position:absolute;
    bottom:0;
    width:100%;
    height:120px;
    background:linear-gradient(#4b2500,#5e2f00);
    border-radius:25px;
}
.layer2{
    position:absolute;
    bottom:100px;
    left:30px;
    width:260px;
    height:90px;
    background:linear-gradient(#5c2e00,#703800);
    border-radius:20px;
}
.layer3{
    position:absolute;
    bottom:170px;
    left:70px;
    width:180px;
    height:70px;
    background:linear-gradient(#6e3a00,#854400);
    border-radius:15px;
}
.icing{
    position:absolute;
    bottom:225px;
    left:70px;
    width:180px;
    height:35px;
    background:linear-gradient(#ff9ac4,#ff6b9d);
    border-radius:40px 40px 20px 20px;
    z-index: 1;
}

.candle{
    position:absolute;
    width:12px;
    height:45px;
    border-radius:6px 6px 3px 3px;
    bottom:235px;
    z-index: 3;
    transition:all 0.3s ease;
}

.c1{ 
    left:115px;
    background:linear-gradient(145deg, #ff6b6b, #feca57);
    box-shadow:0 0 10px rgba(255,107,107,0.5);
}
.c2{ 
    left:155px;
    background:linear-gradient(145deg, #48dbfb, #0abde3);
    box-shadow:0 0 10px rgba(72,219,251,0.5);
}
.c3{ 
    left:195px;
    background:linear-gradient(145deg, #ff9ff3, #f368e0);
    box-shadow:0 0 10px rgba(255,159,243,0.5);
}

.candle.lit .flame{
    opacity:1;
}

.flame{
    position:absolute;
    top:-25px;
    left:50%;
    transform:translateX(-50%);
    width:16px;
    height:26px;
    background:radial-gradient(circle at 30% 30%,#ffd700,#ff4500,transparent);
    border-radius:50% 50% 50% 50% / 60% 60% 40% 40%;
    box-shadow:0 0 20px #ffd700, 0 0 30px #ff4500;
    animation:flicker 1s infinite alternate;
    opacity:0;
}

@keyframes flicker{
    0%{transform:translateX(-50%) scale(1) rotate(-1deg);}
    25%{transform:translateX(-50%) scale(1.1) rotate(1deg);}
    50%{transform:translateX(-50%) scale(0.95) rotate(-2deg);}
    100%{transform:translateX(-50%) scale(1.15) rotate(2deg);}
}

.smoke{
    position:absolute;
    top:-25px;
    left:50%;
    width:25px;
    height:25px;
    border-radius:50%;
    background:radial-gradient(circle,rgba(220,220,220,0.8),rgba(200,200,200,0.4),transparent);
    opacity:0;
}

@keyframes smokeRise{
    0%{transform:translate(-50%,0) scale(1);opacity:0.8;}
    100%{transform:translate(-50%,-150px) scale(3);opacity:0;}
}

.confetti{
    position:absolute;
    width:10px;
    height:10px;
    top:-10px;
    animation:fall linear forwards;
    z-index:1;
}

@keyframes fall{
    to{
        transform:translateY(100vh) rotate(720deg);
        opacity:0;
    }
}

@keyframes pop{
    to{opacity:1; scale:1;}
}
</style>
</head>

<body>
<div class="hearts-wrapper" id="hearts-wrapper"></div>

<div class="cake-container">
    <div class="message" id="msg">
        üïØÔ∏è Light the candles Appiii! üïØÔ∏è
    </div>
    
    <div class="cake">
        <div class="layer1"></div>
        <div class="layer2"></div>
        <div class="layer3"></div>
        <div class="icing"></div>

        <div class="candle c1"><div class="flame"></div><div class="smoke"></div></div>
        <div class="candle c2"><div class="flame"></div><div class="smoke"></div></div>
        <div class="candle c3"><div class="flame"></div><div class="smoke"></div></div>
    </div>
</div>

<audio id="song" src="https://www2.cs.uic.edu/~i101/SoundFiles/HappyBirthday.wav"></audio>

<script>
function createHearts(){
    const wrapper=document.getElementById("hearts-wrapper");
    for(let i=0;i<20;i++){
        const heart=document.createElement("div");
        heart.classList.add("heart");
        heart.style.left=Math.random()*100+"vw";
        heart.style.animationDuration=(6+Math.random()*4)+"s";
        heart.style.animationDelay=Math.random()*6+"s";
        wrapper.appendChild(heart);
    }
}
createHearts();

let clickCount = 0;
const candles = document.querySelectorAll('.candle');
let allLit = false;
let blown = false;
let celebrationDone = false;

// **LIGHT CANDLES - ANYWHERE ON SCREEN**
document.addEventListener('click', function(e) {
    if (clickCount < candles.length && !allLit && !celebrationDone) {
        const unlitCandles = Array.from(candles).filter(candle => !candle.classList.contains('lit'));
        if (unlitCandles.length > 0) {
            const nextCandle = unlitCandles[0];
            nextCandle.classList.add('lit');
            clickCount++;
            console.log(`Candle ${clickCount} lit! (${clickCount}/3)`);
            
            if (clickCount === 3) {
                allLit = true;
                setTimeout(()=>{
                    const msg = document.getElementById("msg");
                    msg.innerHTML = "üéâ Make a wish Appiii!!! üéÇ";
                    msg.style.color = "#ff6b9d";
                    msg.style.fontSize = "32px";
                    msg.classList.remove("show");
                    msg.classList.add("show");
                    startMic();
                }, 500);
            }
        }
    }
    
    // **GO TO PRESENTS PAGE - AFTER CELEBRATION**
    if (celebrationDone) {
        window.location.href = "presents.html";
    }
});

window.onload=()=>{
    setTimeout(()=>{
        document.getElementById("msg").classList.add("show");
    },500);
};

async function startMic(){
    try {
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        const audioContext = new (window.AudioContext||window.webkitAudioContext)();
        const mic = audioContext.createMediaStreamSource(stream);
        const analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        mic.connect(analyser);
        const data = new Uint8Array(analyser.frequencyBinCount);

        function detect(){
            if(blown) return;
            analyser.getByteFrequencyData(data);
            let volume = data.reduce((a,b)=>a+b)/data.length;
            
            if(volume > 60){
                blown = true;
                blowAllCandles();
            }
            requestAnimationFrame(detect);
        }
        detect();
    } catch(err) {
        console.log("Mic access denied, auto-blowing in 3s");
        setTimeout(blowAllCandles, 3000);
    }
}

function blowAllCandles(){
    document.querySelectorAll(".flame").forEach(f=>f.style.opacity=0);

    document.querySelectorAll(".smoke").forEach(s=>{
        s.style.opacity=1;
        s.style.animation="smokeRise 3s forwards";
    });

    launchConfetti();
    document.getElementById("song").play();

    setTimeout(()=>{
        const msg = document.getElementById("msg");
        msg.innerHTML = "‚ú® Click anywhere for PRESENTS! üíù";
        msg.style.color = "#e91e63";
        msg.style.fontSize = "32px";
        msg.classList.add("final");
        msg.classList.remove("show");
        msg.classList.add("show");
        celebrationDone = true;
    },1500);
}

function launchConfetti(){
    for(let i=0;i<120;i++){
        const c=document.createElement("div");
        c.classList.add("confetti");
        c.style.left=Math.random()*100+"vw";
        c.style.background=`hsl(${Math.random()*360},100%,50%)`;
        c.style.animationDuration=(Math.random()*3+2)+"s";
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),5000);
    }
}
</script>

</body>
</html>